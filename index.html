<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gerar Certificado</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
</head>

<body class="container mt-5">

<h3>Gerar Certificado</h3>

<input id="nome" class="form-control mb-2" placeholder="Nome do aluno">
<input id="curso" class="form-control mb-2" placeholder="Curso">
<input id="horas" class="form-control mb-2" placeholder="Horas">
<input id="data" class="form-control mb-2" type="date">

<button class="btn btn-primary" onclick="gerar()">Gerar</button>

<hr>

<div id="qrcode"></div>

<br>
<button onclick="gerarPDF()">Baixar PDF</button>

<script>

const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbxvfYp8lAAdF1bERhUjNP2DBkhscAhOOEgI5pFd36Jw6qzXG0v6NLSUxdXAWKZIZzjP/exec";

function gerar(){

  const id = "CERT-" + Date.now();

  const dados = {
    id: id,
    nome: document.getElementById("nome").value,
    curso: document.getElementById("curso").value,
    horas: document.getElementById("horas").value,
    data: document.getElementById("data").value
  };

function gerarPDF(){

  const { jsPDF } = window.jspdf;

  const nome = document.getElementById("nome").value;
  const curso = document.getElementById("curso").value;
  const horas = document.getElementById("horas").value;
  const data = document.getElementById("data").value;

  const pdf = new jsPDF("landscape", "mm", "a4");

  pdf.setFontSize(22);
  pdf.text("CERTIFICADO", 148, 40, {align:"center"});

  pdf.setFontSize(14);
  pdf.text("Certificamos que", 148, 70, {align:"center"});
  pdf.text(nome, 148, 85, {align:"center"});
  pdf.text("concluiu o curso " + curso, 148, 100, {align:"center"});
  pdf.text("Carga hor√°ria: " + horas + " horas", 148, 115, {align:"center"});
  pdf.text("Data: " + data, 148, 130, {align:"center"});

  const qrCanvas = document.querySelector("#qrcode canvas");
  const qrImage = qrCanvas.toDataURL("image/png");

  pdf.addImage(qrImage, "PNG", 240, 150, 40, 40);

  pdf.save("certificado.pdf");
}

  // envia para planilha
  fetch(URL_SCRIPT,{
    method:"POST",
    body: JSON.stringify(dados)
  });

  // cria QR Code
  document.getElementById("qrcode").innerHTML = "";

  new QRCode(document.getElementById("qrcode"), {
    text: "https://certificado-v435.onrender.com/validar.html?id=" + id,
    width: 120,
    height: 120
  });
}

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</body>
</html>
